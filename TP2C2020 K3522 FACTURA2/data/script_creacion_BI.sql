
/*Dimensiones!*/

USE GD2C2020

CREATE TABLE [GDD2020].[BI_CLIENTE](
	[CLIENTE_CODIGO] BIGINT IDENTITY(1,1) PRIMARY KEY,
	[CLIENTE_DNI] [decimal](18, 0),
	[CLIENTE_APELLIDO] [nvarchar](255),
	[CLIENTE_NOMBRE] [nvarchar](255),
	[EDAD] int,
	[CLASIFICACION_EDAD] varchar(20)
)

INSERT INTO GDD2020.BI_CLIENTE (CLIENTE_DNI,CLIENTE_APELLIDO,CLIENTE_NOMBRE,EDAD,CLASIFICACION_EDAD)
SELECT CLIENTE_DNI,CLIENTE_APELLIDO,CLIENTE_NOMBRE,CALCULAR_EDAD(CLIENTE_FECHA_NAC),CLASIFICAR(CLIENTE_FECHA_NAC)
FROM  GDD2020.CLIENTE

--todo calcular_edad
--todo clasificar_edad

CREATE TABLE [GDD2020].[TIEMPO](
	[CODIGO_FECHA] int NOT NULL PRIMARY KEY,
	[MES] char(2),
	[ANIO] char(4)
)

--todo insertar tiempo



CREATE TABLE [GDD2020].[BI_SUCURSAL](
	[SUCURSAL_CODIGO] BIGINT IDENTITY(1,1) PRIMARY KEY,
	[SUCURSAL_DIRECCION] [nvarchar](255) NULL,
	[SUCURSAL_MAIL] [nvarchar](255) NULL,
	[SUCURSAL_TELEFONO] [decimal](18, 0) NULL,
	[SUCURSAL_CIUDAD] [nvarchar](255) NULL
) ON [PRIMARY] 

INSERT INTO GDD2020.BI_SUCURSAL(SUCURSAL_DIRECCION,SUCURSAL_MAIL,SUCURSAL_TELEFONO)

CREATE TABLE [GDD2020].[BI_MODELO](
	[MODELO_CODIGO] [decimal](18, 0) PRIMARY KEY,
	[MODELO_NOMBRE] [nvarchar](255) ,
	[MODELO_POTENCIA] [decimal](18, 0)
) ON [PRIMARY]

CREATE TABLE [GDD2020].[BI_FABRICANTE](
	[FABRICANTE_CODIGO] BIGINT IDENTITY(1,1) PRIMARY KEY,
	[FABRICANTE_NOMBRE] [nvarchar](255) 
) ON [PRIMARY] 

CREATE TABLE [GDD2020].[BI_TIPOAUTO](
	[TIPO_AUTO_CODIGO] [decimal](18, 0) PRIMARY KEY,
	[TIPO_AUTO_DESC] [nvarchar](255) NULL
) ON [PRIMARY]

CREATE TABLE [GDD2020].[BI_CAJA](
	[TIPO_CAJA_CODIGO] [decimal](18, 0) PRIMARY KEY,
	[TIPO_CAJA_DESC] [nvarchar](255) NULL,
	[AUTO_PARTE_CODIGO] [decimal](18, 0),
	CONSTRAINT FK_AUTO_PARTE_CODIGO_CAJA FOREIGN KEY (AUTO_PARTE_CODIGO) REFERENCES [GDD2020].[AUTOPARTE](AUTO_PARTE_CODIGO)
) ON [PRIMARY]

CREATE TABLE [GDD2020].[BI_AUTOPARTE](
	[AUTO_PARTE_CODIGO] [decimal](18, 0) PRIMARY KEY,
	[AUTO_PARTE_DESCRIPCION] [nvarchar](255) NULL,
	[CODIGO_COMPRA_AUTOPARTE] BIGINT,
	[FAC_AUTOPARTE_CODIGO] BIGINT,
	[MODELO_CODIGO] [decimal](18, 0),
	[FABRICANTE_CODIGO] BIGINT,
	CONSTRAINT FK_BI_MODELO_CODIGO_AUTOPARTE FOREIGN KEY (MODELO_CODIGO) REFERENCES [GDD2020].[BI_MODELO](MODELO_CODIGO),
	CONSTRAINT FK_BI_FABRICANTE_CODIGO_AUTOPARTE FOREIGN KEY (FABRICANTE_CODIGO) REFERENCES [GDD2020].[BI_FABRICANTE](FABRICANTE_CODIGO)
) ON [PRIMARY]

CREATE TABLE [GDD2020].[BI_MOTOR](
	[TIPO_MOTOR_CODIGO] [decimal](18, 0) PRIMARY KEY,
	[AUTO_PARTE_CODIGO] [decimal](18, 0),
	CONSTRAINT FK_BI_AUTO_PARTE_CODIGO_MOTOR FOREIGN KEY (AUTO_PARTE_CODIGO) REFERENCES [GDD2020].[BI_AUTOPARTE](AUTO_PARTE_CODIGO)
) ON [PRIMARY]

CREATE TABLE [GDD2020].[BI_TRANSMISION](
	[TIPO_TRANSMISION_CODIGO] [decimal](18, 0) PRIMARY KEY,
	[TIPO_TRANSMISION_DESC] [nvarchar](255) NULL,
	[AUTO_PARTE_CODIGO] [decimal](18, 0),
	CONSTRAINT FK_BI_AUTO_PARTE_CODIGO_TRANSMISION FOREIGN KEY (AUTO_PARTE_CODIGO) REFERENCES [GDD2020].[BI_AUTOPARTE](AUTO_PARTE_CODIGO)
) ON [PRIMARY] --insertado

CREATE TABLE [GDD2020].[POTENCIA](
	[POTENCIA_CODIGO] BIGINT NOT NULL PRIMARY KEY,
	[MODELO_POTENCIA] [decimal](18,0),
	[MODELO_CODIGO] [decimal](18,0),
	CONSTRAINT FK_BI_MODELO_CODIGO FOREIGN KEY (MODELO_CODIGO) REFERENCES [GDD2020].[BI_MODELO](MODELO_CODIGO)
) ON [PRIMARY]

GO

CREATE VIEW Automoviles_vendidos
AS
SELECT COUNT(ca.COMPRA_AUTOMOVIL_CODIGO),COUNT(fa.FAC_AUTO_CODIGO),ca.SUCURSAL_CODIGO,c.COMPRA_FECHA,f.FACTURA_FECHA
FROM GDD2020.COMPRA_AUTOMOVIL ca
JOIN GDD2020.FACTURA_AUTO fa ON (ca.AUTO_PATENTE = fa.AUTO_PATENTE)
JOIN COMPRA c ON (ca.COMPRA_NRO = c.COMPRA_NRO)
JOIN FACTURACION 


