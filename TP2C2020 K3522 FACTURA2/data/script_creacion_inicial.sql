--Crear el esquema
IF EXISTS (SELECT SCHEMA_ID FROM sys.schemas WHERE [name] = 'GDD2020')
BEGIN
	EXEC('DROP SCHEMA GDD2020');
END

--Borrar todo si existe, para volver a crearlo.

EXEC('CREATE SCHEMA GDD2020 AUTHORIZATION dbo');

--Crear tablas

CREATE TABLE [GDD2020].[CLIENTE](
	[CLIENTE_CODIGO] BIGINT IDENTITY(1,1) PRIMARY KEY,
	[CLIENTE_DNI] [decimal](18, 0),
	[CLIENTE_APELLIDO] [nvarchar](255),
	[CLIENTE_NOMBRE] [nvarchar](255),
	[CLIENTE_DIRECCION] [nvarchar](255) NULL,
	[CLIENTE_FECHA_NAC] [datetime2](3) NULL,
	[CLIENTE_MAIL] [nvarchar](255) NULL
	) ON [PRIMARY]

CREATE TABLE [GDD2020].[TIPOAUTO](
	[TIPO_AUTO_CODIGO] [decimal](18, 0) PRIMARY KEY,
	[TIPO_AUTO_DESC] [nvarchar](255) NULL
) ON [PRIMARY]

CREATE TABLE [GDD2020].[SUCURSAL](
	[SUCURSAL_CODIGO] BIGINT IDENTITY(1,1) PRIMARY KEY,
	[SUCURSAL_DIRECCION] [nvarchar](255) NULL, --TODO VER LOS NULL
	[SUCURSAL_MAIL] [nvarchar](255) NULL,
	[SUCURSAL_TELEFONO] [decimal](18, 0) NULL,
	[SUCURSAL_CIUDAD] [nvarchar](255) NULL
) ON [PRIMARY]

CREATE TABLE [GDD2020].[MODELO](
	[MODELO_CODIGO] [decimal](18, 0) PRIMARY KEY,
	[MODELO_NOMBRE] [nvarchar](255) ,
	[MODELO_POTENCIA] [decimal](18, 0)
) ON [PRIMARY]

CREATE TABLE [GDD2020].[FABRICANTE](
	[FABRICANTE_CODIGO] [SUCURSAL_CODIGO] BIGINT IDENTITY(1,1) PRIMARY KEY,
	[FABRICANTE_NOMBRE] [nvarchar](255) 
) ON [PRIMARY]

-- EJEMPLO para FOREIGN KEYS 	
--CONSTRAINT FK_TIPO_BUTACA FOREIGN KEY (TIPO_BUTACA_CODIGO) REFERENCES [GDD2020].[TIPO_BUTACA](TIPO_BUTACA_CODIGO)


CREATE TABLE [GDD2020].[CAJA](
	[TIPO_CAJA_CODIGO] [decimal](18, 0) PRIMARY KEY,
	[TIPO_CAJA_DESC] [nvarchar](255) NULL,
	[AUTO_PARTE_CODIGO] [decimal](18, 0)
	CONSTRAINT FK_AUTO_PARTE_CODIGO FOREIGN KEY (AUTO_PARTE_CODIGO) REFERENCES [GDD2020].[AUTOPARTE][AUTO_PARTE_CODIGO]
) ON [PRIMARY]

CREATE TABLE [GDD2020].[AUTOMOVIL](
	[AUTO_PATENTE] [nvarchar](50) PRIMARY KEY,
	[AUTO_NRO_CHASIS] [nvarchar](50),
	[AUTO_NRO_MOTOR] [nvarchar](50),
	[AUTO_CANT_KMS] [decimal](18, 0),
	[AUTO_FECHA_ALTA] [datetime2](3),
	[TIPO_TRANSMISION_CODIGO] [decimal](18, 0),
	[MODELO_CODIGO] [decimal](18, 0),
	[FABRICANTE_CODIGO] [SUCURSAL_CODIGO] BIGINT,
	[TIPO_AUTO_CODIGO] [decimal](18, 0)
	CONSTRAINT FK_TIPO_TRANSMISION_CODIGO FOREIGN KEY (TIPO_TRANSMISION_CODIGO) REFERENCES [GDD2020].[TRANSMISION].[TIPO_TRANSMISION_CODIGO]
	CONSTRAINT FK_MODELO_CODIGO FOREIGN KEY (MODELO_CODIGO) REFERENCES [GDD2020].[MODELO].[MODELO_CODIGO]
	CONSTRAINT FK_FABRICANTE_CODIGO FOREIGN KEY FABRICANTE_CODIGO REFERENCES [GDD2020].[FABRICANTE].[FABRICANTE_CODIGO]
	CONSTRAINT FK_TIPO_AUTO_CODIGO FOREIGN KEY TIPO_AUTO_CODIGO REFERENCES [GDD2020].[TIPOAUTO].[TIPO_AUTO_CODIGO]
) ON [PRIMARY]


CREATE TABLE [GDD2020].[MOTOR](
	[TIPO_MOTOR_CODIGO] [decimal](18, 0) PRIMARY KEY,
	[AUTO_PARTE_CODIGO]
	CONTRAINT FK_AUTO_PARTE_CODIGO FOREIGN KEY AUTO_PARTE_CODIGO REFERENCES [GDD2020].[AUTOPARTE].[AUTO_PARTE_CODIGO]
)

CREATE TABLE [GDD2020].[TRANSMISION](
	[TIPO_TRANSMISION_CODIGO] [decimal](18, 0) PRIMARY KEY,
	[TIPO_TRANSMISION_DESC] [nvarchar](255) NULL,
	[AUTO_PARTE_CODIGO]
	CONTRAINT FK_AUTO_PARTE_CODIGO FOREIGN KEY AUTO_PARTE_CODIGO REFERENCES [GDD2020].[AUTOPARTE].[AUTO_PARTE_CODIGO]
)

CREATE TABLE [GDD2020].[AUTOPARTE](
	[AUTO_PARTE_CODIGO] [decimal](18, 0) PRIMARY KEY,
	[AUTO_PARTE_DESCRIPCION] [nvarchar](255) NULL
	--TODO TERMINAR ESTA ENTIDAD (FALTA INFO DE FACTURACION)
)





--Migrar datos

--Crear un usuario para la migraci√≥n

--Crear rol

--Asigno rol al usuario

--INSERTAR en las tablas ( INSERT SELECT)


